<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PRESS PLAY: Video Game Visualisation Dashboard</title>

  <!-- Fonts & Styles -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./node_modules/nes.css/css/nes.min.css">
  <link rel="stylesheet" href="../view/css/global.css" />

  <!-- Vega Embed Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <!-- Custom Element Scripts -->
  <script src="../view/components/section_template.js" defer></script>
</head>

<body>

  <!-- Zelda-style Banner (FULL WIDTH) -->
  <div class="page-banner">
    <h1 class="banner-title flicker">PRESS PLAY</h1>              
    <a href="https://github.com/chicomonster03/press_play" target="_blank" class="github-link">
      <img src="../static/github.png" alt="GitHub" class="github-icon pixel">
    </a>
  </div>

  <!-- Main Content Container -->
  <main class="container">
    <section-template
      align="left"
      title="Game Companies by Country"
      body="
        This choropleth map shows the number of game development companies 
        per country, based on aggregated metadata from open datasets. Darker 
        shades indicate higher concentrations of companies.
      "
      vis-id="developers_map"
      vis-height="500px">
    </section-template>

    <section-template
      align="right"
      title="HLTB stats"
      body="
        This choropleth map shows the number of game development companies 
        per country, based on aggregated metadata from open datasets. Darker 
        shades indicate higher concentrations of companies.
      "
      vis-id="hltb_dumbbell"
      vis-height="500px">
    </section-template>

    <section-template
      align="left"
      title="Game Companies by Country"
      body="
        This choropleth map shows the number of game development companies 
        per country, based on aggregated metadata from open datasets. Darker 
        shades indicate higher concentrations of companies.
      "
      vis-id="map"
      vis-height="500px">
    </section-template>

    <div class="separator"></div>

    <section-template
      align="right"
      title="Review Score vs Story Length"
      body="
        This interactive scatterplot shows how review scores relate to main story 
        length. Use the dropdown to filter by genre.
        Speedrunning outliers and annotations add additional insight.
      "
      vis-id="scatterplot"
      vis-height="600px">
    </section-template>

  </main>

  <!-- Collapsible Toggle JS -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      // Enable collapsible sections
      document.querySelectorAll('[data-collapsible="true"]').forEach(section => {
        const toggleBtn = document.createElement('button');
        toggleBtn.textContent = 'Toggle Section';
        toggleBtn.className = 'snes-button';
        toggleBtn.onclick = () => {
          const layout = section.querySelector('.section-layout');
          layout.style.display = layout.style.display === 'none' ? 'flex' : 'none';
        };
        section.insertBefore(toggleBtn, section.children[1]);
        section.querySelector('.section-layout').style.display = 'none';
      });

      // Load Vega visualisations AFTER section-template is rendered
      setTimeout(() => {
        vegaEmbed('#map', 'map_spec.json', {
          actions: false,
          renderer: 'canvas'
        }).then(result => {
          console.log('Map loaded successfully');
          window.dispatchEvent(new Event('resize'));
        }).catch(console.warn);

        vegaEmbed('#developers_map', '../specs/developers_map_spec.json', {
          actions: false,
          renderer: 'canvas'
        }).then(result => {
          console.log('Developers Map loaded successfully');
          window.dispatchEvent(new Event('resize'));
        }).catch(console.warn);

        vegaEmbed('#hltb_dumbbell', '../specs/hltb_dumbbell_spec.json', {
          actions: false,
          renderer: 'canvas'
        }).then(result => {
          console.log('HLTB Dumbbell loaded successfully');
          window.dispatchEvent(new Event('resize'));
        }).catch(console.warn);

        vegaEmbed('#scatterplot', 'storytime_vs_score_spec.json')
          .then(console.log)
          .catch(console.warn);
      }, 100);
    });
  </script>
</body>
</html>